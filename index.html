<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Wardin perhe - Census 1900</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
            #viewer-container { position: relative; width: 100%; height: 100%; overflow: auto; /* Lisätään skrollausmahdollisuus, jos rivi on liian leveä */
            }

            #census-img { position: absolute; display: block; max-width: none; /* Estetään kuvan kutistuminen */
            }
        #overlay { position: absolute; width: 100%; height: 100%; pointer-events: none; box-shadow: inset 0 0 0 9999px rgba(0,0,0,0.7); display: none; z-index: 10; }
        #spotlight { position: absolute; border: 3px solid #ee7203; box-shadow: 0 0 15px #ee7203; display: none; z-index: 11; }
        #controls { background: #2c2c2c; padding: 20px; z-index: 20; border-top: 2px solid #444; min-height: 120px; }
        button { padding: 12px 24px; background: #ee7203; border: none; color: white; font-weight: bold; cursor: pointer; border-radius: 4px; margin-right: 10px; }
        button:disabled { background: #555; cursor: not-allowed; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="viewer">
        <img id="census-img" src="frank_ward_1900.jpg">
        <div id="overlay"></div>
        <div id="spotlight"></div>
    </div>
    <div id="controls">
        <div id="intro">
            <h2 style="margin:0 0 10px 0;">Frank Wardin perhe - McDavitt, MN (1900)</h2>
            <p>Tutki alkuperäistä väestönlaskenta-arkkia. Käytä ohjattua tutkimusta nähdäksesi tulkinnat.</p>
            <button onclick="startGuide()">Aloita ohjattu tutkiminen</button>
        </div>
        <div id="guide" class="hidden">
            <h3 id="step-title" style="margin:0; color:#ee7203;"></h3>
            <p id="step-text" style="margin:10px 0; font-size: 1.1em;"></p>
            <button id="prevBtn" onclick="changeStep(-1)">Edellinen</button>
            <button id="nextBtn" onclick="changeStep(1)">Seuraava</button>
            <button onclick="resetView()" style="background:#555;">Palaa koko kuvaan</button>
        </div>
    </div>
<script>''
    const steps = [
        {"title":"Väestönlaskennan tiedot","text":"Yhdysvaltain 12. väestönlaskenta 1900.","x":5,"y":0.5,"w":90,"h":15},
        {"title":"Frank Ward (Päämies)","text":"S. 1/1869 Suomi. 31v. USA:han 1886. Na. Maanviljelijä.","x":10.5,"y":62.1,"w":88,"h":1.5},
        {"title":"Siza Ward (Vaimo)","text":"S. 5/1864 Suomi. 36v. 6 lasta elossa. USA:han 1887.","x":10.5,"y":63.6,"w":88,"h":1.5},
        {"title":"Lapset","text":"Suti (8v), Hilda (7v), Arthur (6v), Oscar (4v), Victor (2v) ja Sandra (11kk).","x":10.5,"y":65.2,"w":35,"h":9}
    ];

    let currentStep = 0;
    const img = document.getElementById('census-img');

    function startGuide() {
        document.getElementById('intro').classList.add('hidden');
        document.getElementById('guide').classList.remove('hidden');
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('spotlight').style.display = 'block';
        render(); // Kutsuu piirtofunktiota
    }

    function render() {
        if (!img.src) return;
        const s = steps[currentStep];
        const dpr = window.devicePixelRatio || 1; 
        const zoom = 2.8 * dpr; // Skaalauksen korjaus
        
        const container = document.getElementById('viewer');
        img.style.width = (zoom * 100) + "%";
        
        const targetX = (s.x + s.w/2) / 100 * img.offsetWidth;
        const targetY = (s.y + s.h/2) / 100 * img.offsetHeight;
        
        img.style.left = (container.offsetWidth/2 - targetX) + "px";
        img.style.top = (container.offsetHeight/2 - targetY) + "px";
        
        const spot = document.getElementById('spotlight');
        spot.style.width = (s.w/100 * img.offsetWidth) + "px";
        spot.style.height = (s.h/100 * img.offsetHeight) + "px";
        spot.style.left = (container.offsetWidth/2 - (s.w/100 * img.offsetWidth)/2) + "px";
        spot.style.top = (container.offsetHeight/2 - (s.h/100 * img.offsetHeight)/2) + "px";
    }

    function changeStep(dir) {
        currentStep = Math.max(0, Math.min(steps.length - 1, currentStep + dir));
        render();
        updateText();
    }

    function updateText() {
        const s = steps[currentStep];
        document.getElementById('step-title').innerText = s.title;
        document.getElementById('step-text').innerText = s.text;
    }
</script>

</body>
</html>